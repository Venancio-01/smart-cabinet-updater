@{
    ViewBag.Title = "回收管理";
    Layout = "~/Views/Shared/_Index.cshtml";
}
<script>
    layui.use(['jquery', 'form', 'table', 'dtree', 'common', 'commonTable', 'optimizeSelectOption'], function () {
        var $ = layui.jquery,
            form = layui.form,
            table = layui.table,
            commonTable = layui.commonTable,
            laydtree = layui.dtree,
            laydate = layui.laydate,
            common = layui.common;
        //加载数据
        wcLoading.close();
        //权限控制(js是值传递)
        currentTableBar.innerHTML = common.authorizeButtonNew(currentTableBar.innerHTML);
        toolbarDemo.innerHTML = common.authorizeButtonNew(toolbarDemo.innerHTML);

        //执行一个laydate实例
        laydate.render({
            elem: '#start_time', //指定元素
            type: 'datetime'
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#end_time', //指定元素
            type: 'datetime'
        });

        var options = {
            elem: '#currentTableId',
            url: '/CarrierManage/Carrier/RecoveryGetGridJson',
            defaultToolbar: [
                'filter',
                'print'
            ],

            cols: [[
                { field: 'user_name', title: '回收人', sort: false, filter: false },
                { field: 'remove_time', title: '回收时间', sort: false, filter: false },
                { field: 'remove_count', title: '回收数量', sort: false, filter: false },
                { title: '操作', toolbar: '#currentTableBar', align: "center", fixed: 'right' }
            ]],
        };
        commonTable.rendertable(options);
        // 监听搜索操作
        form.on('submit(data-search-btn)', function (data) {
            options.where = { start_time: data.field.start_time, end_time: data.field.end_time };
            commonTable.reloadtable({elem: 'currentTableId',where:options.where});
            return false;
        });
        // 监听重置操作
        form.on('submit(data-reset-btn)', function (data) {
            $("#start_time").val("");
            $("#end_time").val("");
            options.where = { Carrier_type: 1 };
            commonTable.reloadtable({elem: 'currentTableId',where:options.where});
            return false;
        });


        //行点击事件监听，控制按钮显示
        var oneList = ["NF-ShowRecovery"];//选择1条显示
        commonTable.tableRowClick("currentTableFilter", "currentTableId", oneList);
        /**
         * toolbar监听事件
         */
        table.on('toolbar(currentTableFilter)', function (obj) {
            var data = table.checkStatus('currentTableId').data;
            var keyValue = data.length > 0 ? data[0].id : null;
            var duty = data.length > 0 ? data[0] : null;
            if (obj.event === 'TABLE_SEARCH') {
                var _that = $("#searchField");
                if (_that.hasClass("layui-hide")) {
                    _that.removeClass('layui-hide');
                } else {
                    _that.addClass('layui-hide');
                }
                table.resize();
            }
            return false;
        });
        table.on('tool(currentTableFilter)', function (obj) {
            var keyValue = obj.data.id;
            console.log(keyValue);
            if (obj.event === 'ShowRecovery') {
                common.modalOpen({
                    title: "回收详情",
                    url: "/CarrierManage/Carrier/RecoveryForm?keyValue=" + keyValue,
                    width: "820px",
                    height: "740px",
                });
            }
            return false;
        });
    });
</script>


<div class="layui-fluid" style="padding:0 0px">
    <div class="layui-card" style="margin-bottom: 0px; padding: 5px;">
        <fieldset class="table-search-fieldset" id="searchField">
            <legend>搜索信息</legend>
            <div>
                <form class="layui-form layui-form-pane" action="">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">回收时间：</label>
                            <div class="layui-inline">
                                <input type="text" id="start_time" name="start_time" maxlength="50" class="layui-input" placeholder="开始时间">
                            </div>
                            <span> - </span>
                            <div class="layui-inline">
                                <input type="text" id="end_time" name="end_time" maxlength="50" class="layui-input" placeholder="结束时间">
                            </div>
                        </div>

                        <div class="layui-inline">
                            <button type="submit" class="layui-btn layui-btn-primary" lay-submit lay-filter="data-search-btn"><i class="layui-icon">&#xe615;</i> 搜 索</button>
                            <button type="reset" class="layui-btn layui-btn-warning" lay-submit lay-filter="data-reset-btn"><i class="layui-icon">&#xe615;</i> 重 置</button>
                        </div>
                    </div>
                </form>
            </div>
        </fieldset>
    </div>
    <div class="layui-row layui-col-space5">
        <div class="layui-col-md12 layui-col-xs12">
            <div class="layui-card" style="padding: 5px;">
                <script type="text/html" id="toolbarDemo">
                    <div class="layui-btn-container" id="toolbar">
                    </div>
                </script>
                <script type="text/html" id="currentTableBar">
                    <a id="NF-ShowRecovery" authorize class="layui-btn layui-btn-sm layui-btn-danger data-delete-btn" lay-event="ShowRecovery"><i class="layui-icon">&#xe640;</i>回收详情</a>
                </script>
                <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
            </div>
        </div>
    </div>
</div>
